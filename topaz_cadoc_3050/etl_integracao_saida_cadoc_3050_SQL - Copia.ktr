<?xml version="1.0" encoding="UTF-8"?>
<transformation>
  <info>
    <name>etl_integracao_saida_cadoc_3050_sql</name>
    <description/>
    <extended_description/>
    <trans_version/>
    <trans_type>Normal</trans_type>
    <trans_status>0</trans_status>
    <directory>/</directory>
    <parameters>
      <parameter>
        <name>data_ref</name>
        <default_value>29/07/2021</default_value>
        <description>dd/MM/yyyy</description>
      </parameter>
    </parameters>
    <log>
      <trans-log-table>
        <connection/>
        <schema/>
        <table/>
        <size_limit_lines/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STATUS</id>
          <enabled>Y</enabled>
          <name>STATUS</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
          <subject/>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
          <subject/>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
          <subject/>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
          <subject/>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
          <subject/>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>STARTDATE</id>
          <enabled>Y</enabled>
          <name>STARTDATE</name>
        </field>
        <field>
          <id>ENDDATE</id>
          <enabled>Y</enabled>
          <name>ENDDATE</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>DEPDATE</id>
          <enabled>Y</enabled>
          <name>DEPDATE</name>
        </field>
        <field>
          <id>REPLAYDATE</id>
          <enabled>Y</enabled>
          <name>REPLAYDATE</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>Y</enabled>
          <name>LOG_FIELD</name>
        </field>
        <field>
          <id>EXECUTING_SERVER</id>
          <enabled>N</enabled>
          <name>EXECUTING_SERVER</name>
        </field>
        <field>
          <id>EXECUTING_USER</id>
          <enabled>N</enabled>
          <name>EXECUTING_USER</name>
        </field>
        <field>
          <id>CLIENT</id>
          <enabled>N</enabled>
          <name>CLIENT</name>
        </field>
      </trans-log-table>
      <perf-log-table>
        <connection/>
        <schema/>
        <table/>
        <interval/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>SEQ_NR</id>
          <enabled>Y</enabled>
          <name>SEQ_NR</name>
        </field>
        <field>
          <id>LOGDATE</id>
          <enabled>Y</enabled>
          <name>LOGDATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>INPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>INPUT_BUFFER_ROWS</name>
        </field>
        <field>
          <id>OUTPUT_BUFFER_ROWS</id>
          <enabled>Y</enabled>
          <name>OUTPUT_BUFFER_ROWS</name>
        </field>
      </perf-log-table>
      <channel-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>LOGGING_OBJECT_TYPE</id>
          <enabled>Y</enabled>
          <name>LOGGING_OBJECT_TYPE</name>
        </field>
        <field>
          <id>OBJECT_NAME</id>
          <enabled>Y</enabled>
          <name>OBJECT_NAME</name>
        </field>
        <field>
          <id>OBJECT_COPY</id>
          <enabled>Y</enabled>
          <name>OBJECT_COPY</name>
        </field>
        <field>
          <id>REPOSITORY_DIRECTORY</id>
          <enabled>Y</enabled>
          <name>REPOSITORY_DIRECTORY</name>
        </field>
        <field>
          <id>FILENAME</id>
          <enabled>Y</enabled>
          <name>FILENAME</name>
        </field>
        <field>
          <id>OBJECT_ID</id>
          <enabled>Y</enabled>
          <name>OBJECT_ID</name>
        </field>
        <field>
          <id>OBJECT_REVISION</id>
          <enabled>Y</enabled>
          <name>OBJECT_REVISION</name>
        </field>
        <field>
          <id>PARENT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>PARENT_CHANNEL_ID</name>
        </field>
        <field>
          <id>ROOT_CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>ROOT_CHANNEL_ID</name>
        </field>
      </channel-log-table>
      <step-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>TRANSNAME</id>
          <enabled>Y</enabled>
          <name>TRANSNAME</name>
        </field>
        <field>
          <id>STEPNAME</id>
          <enabled>Y</enabled>
          <name>STEPNAME</name>
        </field>
        <field>
          <id>STEP_COPY</id>
          <enabled>Y</enabled>
          <name>STEP_COPY</name>
        </field>
        <field>
          <id>LINES_READ</id>
          <enabled>Y</enabled>
          <name>LINES_READ</name>
        </field>
        <field>
          <id>LINES_WRITTEN</id>
          <enabled>Y</enabled>
          <name>LINES_WRITTEN</name>
        </field>
        <field>
          <id>LINES_UPDATED</id>
          <enabled>Y</enabled>
          <name>LINES_UPDATED</name>
        </field>
        <field>
          <id>LINES_INPUT</id>
          <enabled>Y</enabled>
          <name>LINES_INPUT</name>
        </field>
        <field>
          <id>LINES_OUTPUT</id>
          <enabled>Y</enabled>
          <name>LINES_OUTPUT</name>
        </field>
        <field>
          <id>LINES_REJECTED</id>
          <enabled>Y</enabled>
          <name>LINES_REJECTED</name>
        </field>
        <field>
          <id>ERRORS</id>
          <enabled>Y</enabled>
          <name>ERRORS</name>
        </field>
        <field>
          <id>LOG_FIELD</id>
          <enabled>N</enabled>
          <name>LOG_FIELD</name>
        </field>
      </step-log-table>
      <metrics-log-table>
        <connection/>
        <schema/>
        <table/>
        <timeout_days/>
        <field>
          <id>ID_BATCH</id>
          <enabled>Y</enabled>
          <name>ID_BATCH</name>
        </field>
        <field>
          <id>CHANNEL_ID</id>
          <enabled>Y</enabled>
          <name>CHANNEL_ID</name>
        </field>
        <field>
          <id>LOG_DATE</id>
          <enabled>Y</enabled>
          <name>LOG_DATE</name>
        </field>
        <field>
          <id>METRICS_DATE</id>
          <enabled>Y</enabled>
          <name>METRICS_DATE</name>
        </field>
        <field>
          <id>METRICS_CODE</id>
          <enabled>Y</enabled>
          <name>METRICS_CODE</name>
        </field>
        <field>
          <id>METRICS_DESCRIPTION</id>
          <enabled>Y</enabled>
          <name>METRICS_DESCRIPTION</name>
        </field>
        <field>
          <id>METRICS_SUBJECT</id>
          <enabled>Y</enabled>
          <name>METRICS_SUBJECT</name>
        </field>
        <field>
          <id>METRICS_TYPE</id>
          <enabled>Y</enabled>
          <name>METRICS_TYPE</name>
        </field>
        <field>
          <id>METRICS_VALUE</id>
          <enabled>Y</enabled>
          <name>METRICS_VALUE</name>
        </field>
      </metrics-log-table>
    </log>
    <maxdate>
      <connection/>
      <table/>
      <field/>
      <offset>0.0</offset>
      <maxdiff>0.0</maxdiff>
    </maxdate>
    <size_rowset>10000</size_rowset>
    <sleep_time_empty>50</sleep_time_empty>
    <sleep_time_full>50</sleep_time_full>
    <unique_connections>N</unique_connections>
    <feedback_shown>Y</feedback_shown>
    <feedback_size>50000</feedback_size>
    <using_thread_priorities>Y</using_thread_priorities>
    <shared_objects_file/>
    <capture_step_performance>N</capture_step_performance>
    <step_performance_capturing_delay>1000</step_performance_capturing_delay>
    <step_performance_capturing_size_limit>100</step_performance_capturing_size_limit>
    <dependencies>
    </dependencies>
    <partitionschemas>
    </partitionschemas>
    <slaveservers>
    </slaveservers>
    <clusterschemas>
    </clusterschemas>
    <created_user>-</created_user>
    <created_date>2019/11/26 20:40:19.774</created_date>
    <modified_user>-</modified_user>
    <modified_date>2019/11/26 20:40:19.774</modified_date>
    <key_for_session_key>H4sIAAAAAAAAAAMAAAAAAAAAAAA=</key_for_session_key>
    <is_key_private>N</is_key_private>
  </info>
  <notepads>
  </notepads>
  <connection>
    <name>TopazDS</name>
    <server>${TOPAZ_HOST}</server>
    <type>MSSQL</type>
    <access>Native</access>
    <database>${TOPAZ_DB}</database>
    <port>1433</port>
    <username>${TOPAZ_USER}</username>
    <password>${TOPAZ_PSWD}</password>
    <servername/>
    <data_tablespace/>
    <index_tablespace/>
    <attributes>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_LOWERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>FORCE_IDENTIFIERS_TO_UPPERCASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>IS_CLUSTERED</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>MSSQL_DOUBLE_DECIMAL_SEPARATOR</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>PORT_NUMBER</code>
        <attribute>1433</attribute>
      </attribute>
      <attribute>
        <code>PRESERVE_RESERVED_WORD_CASE</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>QUOTE_ALL_FIELDS</code>
        <attribute>N</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_BOOLEAN_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>SUPPORTS_TIMESTAMP_DATA_TYPE</code>
        <attribute>Y</attribute>
      </attribute>
      <attribute>
        <code>USE_POOLING</code>
        <attribute>N</attribute>
      </attribute>
    </attributes>
  </connection>
  <order>
    <hop>
      <from>Dados Header</from>
      <to>Prepara Header</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Prepara Header</from>
      <to>Replace in string 1</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Prepara dataRef</from>
      <to>Replace in string 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Grava DocTXB</from>
      <to>Campos Período</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Campos Período</from>
      <to>Dados Período</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Cte groupFIM</from>
      <to>Agrupa FIM</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Agrupa FIM</from>
      <to>Tag DocTXB Fim</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Tag DocTXB Fim</from>
      <to>Grava DocTXB Fim</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Tags Diario</from>
      <to>Grupo Diario</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Grupo Final</from>
      <to>Grava Linha</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Grava Linha</from>
      <to>Cte groupFIM</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>crdPesN.Csng Dia</from>
      <to>crdPesN.Cnsg Mes</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Grupo Diario</from>
      <to>Prepara Mensal</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Prepara Mensal</from>
      <to>Mensal?</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Mensal?</from>
      <to>Tag RefFim</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Grupo Mensal</from>
      <to>Set Mensal</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Tag RefFim</from>
      <to>Sort dataRef</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Sort dataRef</from>
      <to>Grupo Final</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Agrupa por Data</from>
      <to>Tags Diario</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Mensal?</from>
      <to>Grupo Mensal</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Set Mensal</from>
      <to>Var Necessarias</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Var Necessarias</from>
      <to>Tag RefFim</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Ultimo Dia Útil</from>
      <to>Prepara dataRef</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Constantes Arq</from>
      <to>Concatenar Nome Arq</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Replace in string 1</from>
      <to>Constantes Arq</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Concatenar Nome Arq</from>
      <to>Grava DocTXB</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values</from>
      <to>Dados Header</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>crdPesN.Cnsg Mes</from>
      <to>Agrupa por Data</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Dados Dias normais</from>
      <to>crdPesN.Csng Dia</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Select values 2</from>
      <to>Ultimo Dia Útil</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Dados Período</from>
      <to>Datas Adicionais</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Datas Adicionais</from>
      <to>Select values 2</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Replace in string 2</from>
      <to>Filter rows</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows</from>
      <to>14 dias</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>14 dias</from>
      <to>Ate 60</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Ate 60</from>
      <to>Ate 90</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Ate 90</from>
      <to>&gt; 90</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Filter rows</from>
      <to>Dados Dias normais</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>&gt; 90</from>
      <to>crdPesN.Csng Dia</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Obtem Data Ref</from>
      <to>Intervalo Período</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Intervalo Período</from>
      <to>Armazena datas</to>
      <enabled>Y</enabled>
    </hop>
    <hop>
      <from>Armazena datas</from>
      <to>Select values</to>
      <enabled>Y</enabled>
    </hop>
  </order>
  <step>
    <name>14 dias</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT
    '0.00'                                                      AS txmedjurosajustada,
    coalesce(round((SUM(tbl.principal + tbl.jrs + tbl.mora)), 2) ,0) AS sldcarate14,
    coalesce(round((SUM(CAST(tbl.prazo AS INT)) / SUM(CAST(tbl.qtdnov AS INT))), 2), 0)                     AS przmedcarteira,
    0                                                           AS sldbaiprejuizo
FROM
    ( SELECT
    s.jts_oid,
    sd.fecha                                 AS data,
    coalesce(hd.interes_devengado_np_vig, 0) AS jrs,
    coalesce(hd.mora_devengada_vigente, 0)   AS mora,
    abs(coalesce(sd.saldo_al_corte, 0))      AS principal,
    14                                       AS dias,
    sd.fecha - (
        SELECT
            MIN(pp.c2302_original)
        FROM
            planpagos pp
        WHERE
            ( s.jts_oid = pp.saldo_jts_oid
              AND ( ( pp.c2309 + pp.c2310 = 0
                      AND pp.c2313 > sd.fecha )
                    OR ( pp.c2309 + pp.c2310 != 0 ) ) )
    )                                        AS atraso,
    ( coalesce((
        SELECT
            COUNT(s1.c1620)
        FROM
            saldos s1
        WHERE
                s1.jts_oid = s.jts_oid
            AND month(s1.c1620) = month(sd.fecha)
            AND year(s1.c1620) = year(sd.fecha)
        GROUP BY
            s1.c1620
    ), 0) )                                  AS qtdnov,
    coalesce((
                SELECT
                    s.c1627 - s.c1620
                WHERE
                        MONTH(s.c1620) = MONTH(sd.fecha)
                    AND YEAR(s.c1620) = YEAR(sd.fecha)
            ), 0)                                    AS prazo
FROM
    saldos s
    LEFT JOIN grl_saldos_diarios      sd ON  s.jts_oid = sd.saldos_jts_oid
                                         AND sd.saldo_al_corte &lt;= 0
    LEFT JOIN historico_devengamiento hd ON  sd.saldos_jts_oid = hd.saldo_jts_oid
                                         AND sd.fecha = hd.fecha
WHERE
        s.c1785 = 5
    AND s.tz_lock = 0
    ) AS tbl
WHERE
        tbl.data = ?
    AND tbl.atraso &lt;= 14</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>DATA_BASE1</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>362</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>&gt; 90</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT
    coalesce(round((SUM(tbl.principal + tbl.jrs + tbl.mora)), 2), 0) AS sldcarmaior90
FROM
    (
        SELECT
            s.jts_oid,
            sd.fecha                                 AS data,
            coalesce(hd.interes_devengado_np_vig, 0) AS jrs,
            coalesce(hd.mora_devengada_vigente, 0)   AS mora,
            abs(coalesce(sd.saldo_al_corte, 0))      AS principal,
            91                                       AS dias,
            sd.fecha - (
                SELECT
                    MIN(pp.c2302_original)
                FROM
                    planpagos pp
                WHERE
                    ( s.jts_oid = pp.saldo_jts_oid
                      AND ( ( pp.c2309 + pp.c2310 = 0
                              AND pp.c2313 > sd.fecha )
                            OR ( pp.c2309 + pp.c2310 != 0 ) ) )
            )                                        AS atraso
        FROM
            saldos                  s
            LEFT JOIN grl_saldos_diarios      sd ON s.jts_oid = sd.saldos_jts_oid
                                               AND sd.saldo_al_corte &lt;= 0
            LEFT JOIN historico_devengamiento hd ON sd.saldos_jts_oid = hd.saldo_jts_oid
                                                    AND sd.fecha = hd.fecha
        WHERE
                s.c1785 = 5
            AND s.tz_lock = 0
    ) AS tbl
WHERE
    tbl.data = ?
    AND  tbl.atraso > 90</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>DATA_BASE1</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>833</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Agrupa FIM</name>
    <type>MemoryGroupBy</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <give_back_row>N</give_back_row>
    <group>
      <field>
        <name>groupFIM</name>
      </field>
    </group>
    <fields>
      <field>
        <aggregate>ARQ</aggregate>
        <subject>ARQ</subject>
        <type>FIRST_INCL_NULL</type>
        <valuefield/>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>362</xloc>
      <yloc>512</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Agrupa por Data</name>
    <type>MemoryGroupBy</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <give_back_row>N</give_back_row>
    <group>
      <field>
        <name>dataRef</name>
      </field>
    </group>
    <fields>
      <field>
        <aggregate>crdPesNaoConsignadoDiario</aggregate>
        <subject>crdPesNaoConsignadoDiarioW</subject>
        <type>FIRST_INCL_NULL</type>
        <valuefield/>
      </field>
      <field>
        <aggregate>crdPesNaoConsignadoMensal</aggregate>
        <subject>crdPesNaoConsignadoMensalW</subject>
        <type>FIRST_INCL_NULL</type>
        <valuefield/>
      </field>
      <field>
        <aggregate>referencia</aggregate>
        <subject>preparaRef</subject>
        <type>FIRST_INCL_NULL</type>
        <valuefield/>
      </field>
      <field>
        <aggregate>QtdUteis</aggregate>
        <subject>DiasUteis</subject>
        <type>FIRST_INCL_NULL</type>
        <valuefield/>
      </field>
      <field>
        <aggregate>ARQ</aggregate>
        <subject>ARQ</subject>
        <type>FIRST_INCL_NULL</type>
        <valuefield/>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1147</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Armazena datas</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT
	FORMAT (CONVERT(date, ?, 20), 'dd/MM/yyyy')  as dt_ini,
	FORMAT (CONVERT(date, ?, 20), 'dd/MM/yyyy')  as dt_fin,
	FORMAT (CONVERT(date, ?, 20), 'dd/MM/yyyy')  as DATA_INICIO_PERIODO,
	FORMAT (CONVERT(date, ?, 20), 'dd/MM/yyyy')  as DATA_FIM_PERIODO</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>DATA_INICIO_PERIODO1</name>
        <type>String</type>
      </field>
      <field>
        <name>DATA_FIM_PERIODO1</name>
        <type>String</type>
      </field>
      <field>
        <name>DATA_INICIO_PERIODO1</name>
        <type>String</type>
      </field>
      <field>
        <name>DATA_FIM_PERIODO1</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>362</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Ate 60</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT
    coalesce(round((SUM(tbl.principal + tbl.jrs + tbl.mora)), 2), 0) AS sldcarate60
FROM
    (
        SELECT
            s.jts_oid,
            sd.fecha                                 AS data,
            coalesce(hd.interes_devengado_np_vig, 0) AS jrs,
            coalesce(hd.mora_devengada_vigente, 0)   AS mora,
            abs(coalesce(sd.saldo_al_corte, 0))      AS principal,
            60                                       AS dias,
            sd.fecha - (
                SELECT
                    MIN(pp.c2302_original)
                FROM
                    planpagos pp
                WHERE
                    ( s.jts_oid = pp.saldo_jts_oid
                      AND ( ( pp.c2309 + pp.c2310 = 0
                              AND pp.c2313 > sd.fecha )
                            OR ( pp.c2309 + pp.c2310 != 0 ) ) )
            )                                        AS atraso
        FROM
            saldos s
            LEFT JOIN grl_saldos_diarios      sd ON s.jts_oid = sd.saldos_jts_oid
                                                AND sd.saldo_al_corte &lt;= 0
            LEFT JOIN historico_devengamiento hd ON sd.saldos_jts_oid = hd.saldo_jts_oid
                                                AND sd.fecha = hd.fecha
        WHERE
                s.c1785 = 5
            AND s.tz_lock = 0
    ) AS tbl
WHERE
        data = ?
    AND atraso > 14
    AND atraso &lt;= 60</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>DATA_BASE1</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>519</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Ate 90</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT
    coalesce(round((SUM(tbl.principal + tbl.jrs + tbl.mora)), 2), 0) AS sldcarate90
FROM
    (
        SELECT
            s.jts_oid,
            sd.fecha                            AS data,
            coalesce(hd.interes_devengado_np_vig, 0) AS jrs,
            coalesce(hd.mora_devengada_vigente, 0)   AS mora,
            abs(coalesce(sd.saldo_al_corte, 0))      AS principal,
            90                                  AS dias,
            sd.fecha - (
                SELECT
                    MIN(pp.c2302_original)
                FROM
                    planpagos pp
                WHERE
                    ( s.jts_oid = pp.saldo_jts_oid
                      AND ( ( pp.c2309 + pp.c2310 = 0
                              AND pp.c2313 > sd.fecha )
                            OR ( pp.c2309 + pp.c2310 != 0 ) ) )
            )                                   AS atraso
        FROM
            saldos                  s
            LEFT JOIN grl_saldos_diarios      sd ON s.jts_oid = sd.saldos_jts_oid
                                               AND sd.saldo_al_corte &lt;= 0
            LEFT JOIN historico_devengamiento hd ON sd.saldos_jts_oid = hd.saldo_jts_oid
                                                    AND sd.fecha = hd.fecha
        WHERE
                s.c1785 = 5
            AND s.tz_lock = 0
    ) AS tbl
WHERE
        tbl.data = ?
    AND tbl.atraso > 60
    AND tbl.atraso &lt;= 90</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>DATA_BASE1</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>676</xloc>
      <yloc>176</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Campos Período</name>
    <type>SelectValues</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>DATA_INICIO_PERIODO</name>
      </field>
      <field>
        <name>DATA_FIM_PERIODO</name>
      </field>
      <field>
        <name>ARQ</name>
      </field>
      <field>
        <name>DT_INI1</name>
      </field>
      <field>
        <name>DT_FIN1</name>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>833</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Concatenar Nome Arq</name>
    <type>ConcatFields</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator/>
    <enclosure>"</enclosure>
    <enclosure_forced>N</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>N</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>N</fileNameInField>
    <fileNameField/>
    <create_parent_folder>Y</create_parent_folder>
    <file>
      <name>file</name>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>N</do_not_open_new_file_init>
      <extention>txt</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>CAMINHO</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>EXT_ARQUIVO</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>DATA_PROC</name>
        <type>Date</type>
        <format>yyyyMMdd</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>8</length>
        <precision>-1</precision>
      </field>
    </fields>
    <ConcatFields>
      <targetFieldName>ARQ</targetFieldName>
      <targetFieldLength>100</targetFieldLength>
      <removeSelectedFields>N</removeSelectedFields>
    </ConcatFields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1147</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Constantes Arq</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>EXT_ARQUIVO</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>\DOC3050_TOPAZ_</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1147</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Cte groupFIM</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>groupFIM</name>
        <type>Integer</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>1</nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>208</xloc>
      <yloc>512</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Dados Dias normais</name>
    <type>DBJoin</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT
	'0.00' 							AS txMedJurosAjustada,
	'0.00'  						AS sldCarAte14,
	'0' 							AS przMedCarteira,
	'0.00'  						AS sldBaiPrejuizo,
	'0.00'  	 					AS sldCarAte60,
	'0.00' 							AS sldCarAte90,
	'0.00' 							AS sldCarMaior90</sql>
    <outer_join>N</outer_join>
    <replace_vars>N</replace_vars>
    <parameter>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>362</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Dados Header</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT
	RIGHT(REPLICATE('0', 8) + EMP.cnpj_empresa, 8)              AS cnpjInstituicao,
--	? 															AS "dataBase",
	'I'															AS indRemessa,
	'CLAUDIA REGINA FERNANDES FERREIRA'							AS nmContato,
	'11-21428400'												AS telContato,
	'2' as COD_SIS_ORIGEM
FROM empresas EMP
</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>676</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Dados Período</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT 
    tbl.data_base                                       AS data_base1,

    round((
        CASE
            WHEN SUM(tbl.qtdnov) > 0 THEN
                round(round((SUM(CAST(coalesce(tbl.prazo, 0) AS DECIMAL)) / (SUM(CAST(coalesce(tbl.qtdnov, 1) AS DECIMAL)) - (
                    SELECT
                        coalesce(COUNT(*), 0)
                    FROM
                        vw_rel_cancelamento d
                    WHERE
                            d.datacontratacao = tbl.data_base
                        AND d.datacancelamento = tbl.data_base
                ))), 2), 2)
            ELSE
                0
        END
    ), 2)                                               AS przdecmedconcessoes, 
    0                                                   AS sldadquirido,
    round((SUM(tbl.principal + tbl.jrs + tbl.mora)), 2) AS sldcarativa,
    0                                                   AS sldcedido,
    round((
        CASE
            WHEN SUM(tbl.qtdnov) > 0 THEN
                (power(SUM(CAST(coalesce(tbl.iof, 0) AS DECIMAL)) / (SUM(CAST(coalesce(tbl.principal1, 1) AS DECIMAL)) + SUM(CAST(coalesce(
                tbl.iof, 0) AS DECIMAL))) + 1,(360 /(round((SUM(CAST(coalesce(tbl.prazo, 1) AS DECIMAL)) /(SUM(tbl.qtdnov) - (
                    SELECT
                        coalesce(COUNT(*), 0)
                    FROM
                        vw_rel_cancelamento d
                    WHERE
                            d.datacontratacao = tbl.data_base
                        AND d.datacancelamento = tbl.data_base
                ))), 2)))) - 1 * 100)
            ELSE
                0
        END
    ), 2)                                               AS txmedencfiscais, 
    '0.00'                                              AS txmedencoperacionais, 
    CASE
        WHEN SUM(tbl.qtdnov) > 0 THEN
            SUM(coalesce(tbl.txd, 0)) / ( SUM(tbl.qtdnov) - (
                SELECT
                    coalesce(COUNT(*), 0)
                FROM
                    vw_rel_cancelamento d
                WHERE
                        d.datacontratacao = tbl.data_base
                    AND d.datacancelamento = tbl.data_base
            ) )
        ELSE
            0
    END                                                 AS txmedjuros, 
    CASE
        WHEN SUM(tbl.qtdnov) > 0 THEN
         round	((SUM(tbl.principal1) + -SUM(coalesce(tbl.iof, cast('0' as decimal(15,2)))) -
					(SELECT coalesce(SUM(d.valorfinanciado), cast('0' as decimal(15,2)))
						FROM vw_rel_cancelamento d
						WHERE	d.datacontratacao = tbl.data_base
							AND d.datacancelamento = tbl.data_base)
					), 2)
        ELSE
            cast('10.15' as decimal(15,2))
    END                                             AS vlrconcessoes 
FROM
    (
        SELECT
            ( coalesce((
                SELECT
                    COUNT(s1.c1620)
                FROM
                    saldos s1
                WHERE
                        s1.jts_oid = s.jts_oid
                    AND s1.c1620 = sd.fecha
                GROUP BY
                    s1.c1620
            ), 0) )                                  AS qtdnov,
            s.c1632                                  AS tx,
            sd.fecha                                 AS data_base,
            s.c1620                                  fecha,
            s.jts_oid,
            sd.saldos_jts_oid                        AS jts1,
            coalesce((
                SELECT
                    s.c1627 - s.c1620
                WHERE
                    s.c1620 = sd.fecha
            ), 0)                                    AS prazo,
            coalesce((
                SELECT
                    s.c1632
                WHERE
                    s.c1620 = sd.fecha
            ), 0) as txd,
			coalesce(hd.interes_devengado_np_vig, 0) AS jrs,
			coalesce(hd.mora_devengada_vigente, 0) AS mora,
			abs(coalesce(sd.saldo_al_corte, 0)) AS principal,
			coalesce((
    		SELECT
        		(SUM((CAST(s1.iof_ad AS DECIMAL(15,2)) + (CAST(s1.iof_prazo AS DECIMAL(15,2))))))
    		FROM
        		saldos s1
    		WHERE
            		s1.tz_lock = 0
        		AND s1.jts_oid = s.jts_oid
            		AND s1.c1620 = sd.fecha
			), 0) AS iof,
			(
    		SELECT
        		coalesce(s1.c1758, 0)
    		FROM
        		saldos s1
    		WHERE
        		    s1.tz_lock = 0
       		 AND s1.jts_oid = s.jts_oid
         		   AND s1.c1620 = sd.fecha
			) AS principal1
       		 FROM
            		saldos s
            		LEFT JOIN grl_saldos_diarios      sd ON  s.jts_oid = sd.saldos_jts_oid
                    		                             AND sd.saldo_al_corte &lt;= 0
            		LEFT JOIN historico_devengamiento hd ON  sd.saldos_jts_oid = hd.saldo_jts_oid
                    		                             AND sd.fecha = hd.fecha
        		WHERE
                		s.c1785 = 5
            		AND s.tz_lock = 0     
    ) AS tbl
WHERE tbl.data_base BETWEEN ? AND ?
GROUP BY
    tbl.data_base
ORDER BY
    tbl.data_base</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>DT_INI1</name>
        <type>String</type>
      </field>
      <field>
        <name>DT_FIN1</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>676</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Datas Adicionais</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SELECT DISTINCT
    CONVERT(date, ?, 103) AS dataRef1,
	CONVERT(date, ?, 103) AS dataInv1,
	DATEADD(DAY, +1, EOMONTH(CONVERT(date, ?, 103))) AS PriDiaPfroxMes1
</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>DATA_BASE1</name>
        <type>String</type>
      </field>
      <field>
        <name>DATA_BASE1</name>
        <type>String</type>
      </field>
      <field>
        <name>DATA_BASE1</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>519</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Filter rows</name>
    <type>FilterRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <send_true_to>14 dias</send_true_to>
    <send_false_to>Dados Dias normais</send_false_to>
    <compare>
      <condition>
        <negated>N</negated>
        <leftvalue>DIASUTEIS</leftvalue>
        <function>=</function>
        <rightvalue/>
        <value>
          <name>constant</name>
          <type>BigNumber</type>
          <text>1.0</text>
          <length>-1</length>
          <precision>-1</precision>
          <isnull>N</isnull>
          <mask>######0.0###################;-######0.0###################</mask>
        </value>
      </condition>
    </compare>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>205</xloc>
      <yloc>216</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Grava DocTXB</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator/>
    <enclosure/>
    <enclosure_forced>N</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>N</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding>ISO-8859-1</encoding>
    <endedLine/>
    <fileNameInField>Y</fileNameInField>
    <fileNameField>ARQ</fileNameField>
    <create_parent_folder>Y</create_parent_folder>
    <file>
      <name/>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>Y</do_not_open_new_file_init>
      <extention>xml</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>preparaHeader</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>990</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Grava DocTXB Fim</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator/>
    <enclosure/>
    <enclosure_forced>N</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>N</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding>ISO-8859-1</encoding>
    <endedLine/>
    <fileNameInField>Y</fileNameInField>
    <fileNameField>ARQ</fileNameField>
    <create_parent_folder>Y</create_parent_folder>
    <file>
      <name/>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>Y</do_not_open_new_file_init>
      <extention>xml</extention>
      <append>Y</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>DocTXB</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>branco</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>676</xloc>
      <yloc>512</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Grava Linha</name>
    <type>TextFileOutput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator/>
    <enclosure/>
    <enclosure_forced>N</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>N</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding>ISO-8859-1</encoding>
    <endedLine/>
    <fileNameInField>Y</fileNameInField>
    <fileNameField>ARQ</fileNameField>
    <create_parent_folder>Y</create_parent_folder>
    <file>
      <name/>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>Y</do_not_open_new_file_init>
      <extention>xml</extention>
      <append>Y</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>linha</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>512</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Grupo Diario</name>
    <type>ConcatFields</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator/>
    <enclosure/>
    <enclosure_forced>N</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>N</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>N</fileNameInField>
    <fileNameField/>
    <create_parent_folder>Y</create_parent_folder>
    <file>
      <name>file</name>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>Y</do_not_open_new_file_init>
      <extention>txt</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>referencia</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>diarioInicio</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>crdPesNaoConsignadoDiario</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>diarioFim</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
    <ConcatFields>
      <targetFieldName>linhaDiario</targetFieldName>
      <targetFieldLength>0</targetFieldLength>
      <removeSelectedFields>N</removeSelectedFields>
    </ConcatFields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>990</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Grupo Final</name>
    <type>ConcatFields</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator/>
    <enclosure/>
    <enclosure_forced>N</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>N</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>N</fileNameInField>
    <fileNameField/>
    <create_parent_folder>Y</create_parent_folder>
    <file>
      <name>file</name>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>Y</do_not_open_new_file_init>
      <extention>txt</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>linhaDiario</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>linhaMensal</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>ReferenciaFim</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
    <ConcatFields>
      <targetFieldName>linha</targetFieldName>
      <targetFieldLength>0</targetFieldLength>
      <removeSelectedFields>N</removeSelectedFields>
    </ConcatFields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Grupo Mensal</name>
    <type>ConcatFields</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <separator/>
    <enclosure/>
    <enclosure_forced>N</enclosure_forced>
    <enclosure_fix_disabled>N</enclosure_fix_disabled>
    <header>N</header>
    <footer>N</footer>
    <format>DOS</format>
    <compression>None</compression>
    <encoding/>
    <endedLine/>
    <fileNameInField>N</fileNameInField>
    <fileNameField/>
    <create_parent_folder>Y</create_parent_folder>
    <file>
      <name>file</name>
      <servlet_output>N</servlet_output>
      <do_not_open_new_file_init>Y</do_not_open_new_file_init>
      <extention>txt</extention>
      <append>N</append>
      <split>N</split>
      <haspartno>N</haspartno>
      <add_date>N</add_date>
      <add_time>N</add_time>
      <SpecifyFormat>N</SpecifyFormat>
      <date_time_format/>
      <add_to_result_filenames>Y</add_to_result_filenames>
      <pad>N</pad>
      <fast_dump>N</fast_dump>
      <splitevery>0</splitevery>
    </file>
    <fields>
      <field>
        <name>mensalInicio</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>crdPesNaoConsignadoMensal</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
      <field>
        <name>mensalFim</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <trim_type>none</trim_type>
        <length>-1</length>
        <precision>-1</precision>
      </field>
    </fields>
    <ConcatFields>
      <targetFieldName>linhaMensalw</targetFieldName>
      <targetFieldLength>0</targetFieldLength>
      <removeSelectedFields>N</removeSelectedFields>
    </ConcatFields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>676</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Intervalo Período</name>
    <type>DBJoin</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>SET DATEFIRST 7
SELECT dia,
	DT.DATA_PROC1,
  CASE DT.DIA
  	WHEN '6' THEN
        (DATEADD(DAY, -10, DT.DATA_PROC1))
  	WHEN '5' THEN
    	(DATEADD(DAY, -10, DT.DATA_PROC1))
  	WHEN '4' THEN
    	(DATEADD(DAY, -9, DT.DATA_PROC1))
  	WHEN '3' THEN
  		(DATEADD(DAY, -8, DT.DATA_PROC1))
  	WHEN '2' THEN
  		(DATEADD(DAY, -7, DT.DATA_PROC1))
  	ELSE
  		(DATEADD(DAY, -11, DT.DATA_PROC1))
  	END AS DATA_INICIO_PERIODO1,
  CASE DT.DIA
  	WHEN '6' THEN
  		(DATEADD(DAY, -7, DT.DATA_PROC1))
  	WHEN '5' THEN
  		(DATEADD(DAY, -6, DT.DATA_PROC1))
  	WHEN '4' THEN
  		(DATEADD(DAY, -5, DT.DATA_PROC1))
  	WHEN '3' THEN
  		(DATEADD(DAY, -4, DT.DATA_PROC1))
  	WHEN '2' THEN
  		(DATEADD(DAY, -3, DT.DATA_PROC1))
  	ELSE
  		(DATEADD(DAY, -7, DT.DATA_PROC1))
  	END AS DATA_FIM_PERIODO1,
  '${CADOC_3050_OUTPUT}' AS CAMINHO
FROM 
  (SELECT CONVERT(date, ?, 103) AS DATA_PROC1,
        DATEPART(WEEKDAY, (CONVERT(date, ?, 103))) AS DIA ) DT</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>DATA_REF</name>
        <type>String</type>
      </field>
      <field>
        <name>DATA_REF</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>205</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Mensal?</name>
    <type>SwitchCase</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fieldname>QtdUteis</fieldname>
    <use_contains>N</use_contains>
    <case_value_type>None</case_value_type>
    <case_value_format/>
    <case_value_decimal/>
    <case_value_group/>
    <default_target_step>Tag RefFim</default_target_step>
    <cases>
      <case>
        <value>1.0</value>
        <target_step>Grupo Mensal</target_step>
      </case>
    </cases>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>676</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Obtem Data Ref</name>
    <type>TableInput</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <sql>SELECT 
	CASE 
	WHEN '${data_ref}' = '' THEN (select FORMAT (getdate(), 'dd/MM/yyyy'))
 	ELSE '${data_ref}'
	END AS DATA_REF
	FROM PARAMETROS</sql>
    <limit>0</limit>
    <lookup/>
    <execute_each_row>N</execute_each_row>
    <variables_active>Y</variables_active>
    <lazy_conversion_active>N</lazy_conversion_active>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Prepara Header</name>
    <type>AddXML</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <encoding>ISO-8859-1</encoding>
    <valueName>preparaHeaderW</valueName>
    <xml_repeat_element>DocTXB</xml_repeat_element>
    <file>
      <omitXMLheader>N</omitXMLheader>
      <omitNullValues>N</omitNullValues>
    </file>
    <fields>
      <field>
        <name>cnpjInstituicao</name>
        <element/>
        <type>Integer</type>
        <format>00000000000000</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>14</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>DATA_FIM_PERIODO1</name>
        <element>dataBase</element>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>10</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>indRemessa</name>
        <element/>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>nmContato</name>
        <element/>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>13</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>telContato</name>
        <element/>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>11</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>833</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Prepara Mensal</name>
    <type>Constant</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>linhaMensal</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>Y</set_empty_string>
      </field>
      <field>
        <name>mensalInicio</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>&lt;mensal>&lt;crdLivre>&lt;pesFisica>&lt;pre></nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>mensalFim</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>&lt;/pre>&lt;/pesFisica>&lt;/crdLivre>&lt;/mensal></nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>833</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Prepara dataRef</name>
    <type>AddXML</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <encoding>UTF-8</encoding>
    <valueName>preparaRefW</valueName>
    <xml_repeat_element>referencia</xml_repeat_element>
    <file>
      <omitXMLheader>Y</omitXMLheader>
      <omitNullValues>N</omitNullValues>
    </file>
    <fields>
      <field>
        <name>dataRef</name>
        <element/>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>10</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Replace in string 1</name>
    <type>ReplaceString</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <in_stream_name>preparaHeaderW</in_stream_name>
        <out_stream_name>preparaHeader</out_stream_name>
        <use_regex>no</use_regex>
        <replace_string>/</replace_string>
        <replace_by_string/>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>990</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Replace in string 2</name>
    <type>ReplaceString</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <in_stream_name>preparaRefW</in_stream_name>
        <out_stream_name>preparaRef</out_stream_name>
        <use_regex>no</use_regex>
        <replace_string>/</replace_string>
        <replace_by_string/>
        <set_empty_string>N</set_empty_string>
        <replace_field_by_string/>
        <whole_word>no</whole_word>
        <case_sensitive>no</case_sensitive>
        <is_unicode>no</is_unicode>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>48</xloc>
      <yloc>216</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select values</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>N</select_unspecified>
      <meta>
        <name>DATA_PROC1</name>
        <rename>DATA_PROC</rename>
        <type>Date</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>yyyyMMdd</conversion_mask>
        <date_format_lenient>true</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DT_INI</name>
        <rename>DT_INI1</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>DT_FIN</name>
        <rename>DT_FIN1</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>false</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>519</xloc>
      <yloc>16</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Select values 2</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <select_unspecified>Y</select_unspecified>
      <meta>
        <name>dataInv1</name>
        <rename>dataInv</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask/>
        <date_format_lenient>true</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>dataRef1</name>
        <rename>dataRef</rename>
        <type>String</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>yyyyMMdd</conversion_mask>
        <date_format_lenient>true</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
      <meta>
        <name>PriDiaPfroxMes1</name>
        <rename>PriDiaPfroxMes</rename>
        <type>Date</type>
        <length>-2</length>
        <precision>-2</precision>
        <conversion_mask>yyyyMMdd</conversion_mask>
        <date_format_lenient>true</date_format_lenient>
        <date_format_locale/>
        <date_format_timezone/>
        <lenient_string_to_number>false</lenient_string_to_number>
        <encoding/>
        <decimal_symbol/>
        <grouping_symbol/>
        <currency_symbol/>
        <storage_type/>
      </meta>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>362</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Set Mensal</name>
    <type>SetValueField</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>linhaMensal</name>
        <replaceby>linhaMensalw</replaceby>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>519</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Sort dataRef</name>
    <type>SortRows</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <directory>%%java.io.tmpdir%%</directory>
    <prefix>out</prefix>
    <sort_size>1000000</sort_size>
    <free_memory/>
    <compress>N</compress>
    <compress_variable/>
    <unique_rows>N</unique_rows>
    <fields>
      <field>
        <name>dataRef</name>
        <ascending>Y</ascending>
        <case_sensitive>N</case_sensitive>
        <collator_enabled>N</collator_enabled>
        <collator_strength>0</collator_strength>
        <presorted>N</presorted>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>205</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Tag DocTXB Fim</name>
    <type>Constant</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>DocTXB</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>&lt;/DocTXB></nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>branco</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>  </nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>519</xloc>
      <yloc>512</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Tag RefFim</name>
    <type>Constant</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>ReferenciaFim</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>&lt;/referencia></nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>362</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Tags Diario</name>
    <type>Constant</type>
    <description/>
    <distribute>N</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>diarioInicio</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>&lt;diario>&lt;crdLivre>&lt;pesFisica>&lt;pre></nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
      <field>
        <name>diarioFim</name>
        <type>String</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif>&lt;/pre>&lt;/pesFisica>&lt;/crdLivre>&lt;/diario></nullif>
        <length>-1</length>
        <precision>-1</precision>
        <set_empty_string>N</set_empty_string>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>1152</xloc>
      <yloc>352</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Ultimo Dia Útil</name>
    <type>DBJoin</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <connection>TopazDS</connection>
    <rowlimit>0</rowlimit>
    <sql>WITH DIAS AS (
  SELECT 1 AS LEVEL
  UNION ALL
  SELECT LEVEL + 1
  FROM DIAS 
  WHERE LEVEL &lt; 7 
)
SELECT 
     CASE 
        WHEN MAX(DT.DIA) = ? THEN 1	
        ELSE 0
        END AS DiasUteis
FROM 
(
SELECT 
DATEADD(DAY, + 1, DATEADD(DAY, - LEVEL, EOMONTH(CONVERT(date, ?, 20)))) AS DIA
FROM DIAS
) DT
INNER JOIN VW_FERIADOS_BRASIL2 V ON V.DT_COMPLETO &lt;&gt; DT.DIA AND V.MESFERIADO &lt;&gt; 0
WHERE
    UPPER(FORMAT(DT.DIA, 'ddd')) NOT IN ('SAT', 'SUN')
    AND V.UFFERIADO = ' '</sql>
    <outer_join>N</outer_join>
    <replace_vars>Y</replace_vars>
    <parameter>
      <field>
        <name>dataInv</name>
        <type>String</type>
      </field>
      <field>
        <name>dataInv</name>
        <type>String</type>
      </field>
    </parameter>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>205</xloc>
      <yloc>96</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>Var Necessarias</name>
    <type>SelectValues</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <fields>
      <field>
        <name>dataRef</name>
      </field>
      <field>
        <name>crdPesNaoConsignadoDiario</name>
      </field>
      <field>
        <name>crdPesNaoConsignadoMensal</name>
      </field>
      <field>
        <name>referencia</name>
      </field>
      <field>
        <name>QtdUteis</name>
      </field>
      <field>
        <name>ARQ</name>
      </field>
      <field>
        <name>diarioInicio</name>
      </field>
      <field>
        <name>diarioFim</name>
      </field>
      <field>
        <name>linhaDiario</name>
      </field>
      <field>
        <name>linhaMensal</name>
      </field>
      <field>
        <name>mensalInicio</name>
      </field>
      <field>
        <name>mensalFim</name>
      </field>
      <select_unspecified>N</select_unspecified>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>362</xloc>
      <yloc>432</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>crdPesN.Cnsg Mes</name>
    <type>AddXML</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <encoding>UTF-8</encoding>
    <valueName>crdPesNaoConsignadoMensalW</valueName>
    <xml_repeat_element>crdPesNaoConsignado</xml_repeat_element>
    <file>
      <omitXMLheader>Y</omitXMLheader>
      <omitNullValues>N</omitNullValues>
    </file>
    <fields>
      <field>
        <name>sldBaiPrejuizo</name>
        <element/>
        <type>Integer</type>
        <format>0</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>sldCarAte14</name>
        <element/>
        <type>Integer</type>
        <format>0</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>sldCarAte60</name>
        <element/>
        <type>Integer</type>
        <format>0</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>sldCarAte90</name>
        <element/>
        <type>Integer</type>
        <format>0</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>sldCarMaior90</name>
        <element/>
        <type>Integer</type>
        <format>0</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>przMedCarteira</name>
        <element/>
        <type>None</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>990</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step>
    <name>crdPesN.Csng Dia</name>
    <type>AddXML</type>
    <description/>
    <distribute>Y</distribute>
    <custom_distribution/>
    <copies>1</copies>
    <partitioning>
      <method>none</method>
      <schema_name/>
    </partitioning>
    <encoding>UTF-8</encoding>
    <valueName>crdPesNaoConsignadoDiarioW</valueName>
    <xml_repeat_element>crdPesNaoConsignado</xml_repeat_element>
    <file>
      <omitXMLheader>Y</omitXMLheader>
      <omitNullValues>N</omitNullValues>
    </file>
    <fields>
      <field>
        <name>txMedJuros</name>
        <element/>
        <type>Number</type>
        <format>0.00</format>
        <currency/>
        <decimal>.</decimal>
        <group/>
        <nullif/>
        <length>6</length>
        <precision>2</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>txMedEncFiscais</name>
        <element/>
        <type>Number</type>
        <format>0.00</format>
        <currency/>
        <decimal>.</decimal>
        <group/>
        <nullif/>
        <length>6</length>
        <precision>2</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>txMedEncOperacionais</name>
        <element/>
        <type>Number</type>
        <format>0.00</format>
        <currency/>
        <decimal>.</decimal>
        <group/>
        <nullif/>
        <length>6</length>
        <precision>2</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>przDecMedConcessoes</name>
        <element/>
        <type>None</type>
        <format/>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>vlrConcessoes</name>
        <element/>
        <type>Integer</type>
        <format>0</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>sldCarAtiva</name>
        <element/>
        <type>Integer</type>
        <format>0</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>sldCedido</name>
        <element/>
        <type>Integer</type>
        <format>0</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
      <field>
        <name>sldAdquirido</name>
        <element/>
        <type>Integer</type>
        <format>0</format>
        <currency/>
        <decimal/>
        <group/>
        <nullif/>
        <length>-1</length>
        <precision>-1</precision>
        <attribute>Y</attribute>
        <attributeParentName/>
      </field>
    </fields>
    <attributes/>
    <cluster_schema/>
    <remotesteps>
      <input>
      </input>
      <output>
      </output>
    </remotesteps>
    <GUI>
      <xloc>833</xloc>
      <yloc>256</yloc>
      <draw>Y</draw>
    </GUI>
  </step>
  <step_error_handling>
  </step_error_handling>
  <slave-step-copy-partition-distribution>
  </slave-step-copy-partition-distribution>
  <slave_transformation>N</slave_transformation>
  <attributes/>
</transformation>
